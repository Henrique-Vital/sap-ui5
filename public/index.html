<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>App SAPUI5 CRUD Completo</title>
    <script
      id="sap-ui-bootstrap"
      src="https://sdk.openui5.org/resources/sap-ui-core.js"
      data-sap-ui-theme="sap_fiori_3"
      data-sap-ui-libs="sap.m,sap.ui.layout"
      data-sap-ui-xx-bindingSyntax="complex">
    </script>

    <script>
      sap.ui.getCore().attachInit(function () {

        // ==============================
        // Temas disponíveis
        // ==============================
        var themes = ["sap_fiori_3", "sap_fiori_3_dark", "sap_horizon"];
        var currentTheme = 0;

        // ==============================
        // Modelo de dados
        // ==============================
        var oModel = new sap.ui.model.json.JSONModel({
            clientes: [
                { nome: "Maria Silva", cidade: "São Paulo", idade: 28, email: "maria@email.com" },
                { nome: "João Souza", cidade: "Rio de Janeiro", idade: 35, email: "joao@email.com" },
                { nome: "Ana Costa", cidade: "Belo Horizonte", idade: 42, email: "ana@email.com" },
                { nome: "Carlos Almeida", cidade: "Curitiba", idade: 30, email: "carlos@email.com" },
                { nome: "Fernanda Lima", cidade: "Salvador", idade: 25, email: "fernanda@email.com" },
                { nome: "Rafael Santos", cidade: "Porto Alegre", idade: 33, email: "rafael@email.com" },
                { nome: "Beatriz Oliveira", cidade: "Recife", idade: 29, email: "beatriz@email.com" },
                { nome: "Lucas Pereira", cidade: "Fortaleza", idade: 37, email: "lucas@email.com" },
                { nome: "Juliana Fernandes", cidade: "Brasília", idade: 31, email: "juliana@email.com" },
                { nome: "Thiago Rodrigues", cidade: "Manaus", idade: 26, email: "thiago@email.com" }
            ],
            clienteSelecionado: {}
            });

            sap.ui.getCore().setModel(oModel);


        // ==============================
        // Botão para mudar tema
        // ==============================
        var oThemeButton = new sap.m.Button({
          text: "Trocar Tema",
          icon: "sap-icon://color-fill",
          type: "Emphasized",
          press: function () {
            currentTheme = (currentTheme + 1) % themes.length;
            sap.ui.getCore().applyTheme(themes[currentTheme]);
            sap.m.MessageToast.show("Tema alterado para: " + themes[currentTheme]);
          }
        });

        // ==============================
        // Botão para adicionar cliente
        // ==============================
        var oAddButton = new sap.m.Button({
          text: "Adicionar Cliente",
          icon: "sap-icon://add",
          type: "Accept",
          press: function () {
            var oDialog = new sap.m.Dialog({
              title: "Novo Cliente",
              content: [
                new sap.m.Label({text: "Nome"}), new sap.m.Input("newNome"),
                new sap.m.Label({text: "Cidade"}), new sap.m.Input("newCidade"),
                new sap.m.Label({text: "Idade"}), new sap.m.Input("newIdade", {type: "Number"}),
                new sap.m.Label({text: "Email"}), new sap.m.Input("newEmail")
              ],
              beginButton: new sap.m.Button({
                text: "Salvar",
                type: "Accept",
                press: function () {
                  var nome = sap.ui.getCore().byId("newNome").getValue();
                  var cidade = sap.ui.getCore().byId("newCidade").getValue();
                  var idade = sap.ui.getCore().byId("newIdade").getValue();
                  var email = sap.ui.getCore().byId("newEmail").getValue();

                  if(nome && cidade && idade && email){
                    var clientes = oModel.getProperty("/clientes");
                    clientes.push({nome: nome, cidade: cidade, idade: parseInt(idade), email: email});
                    oModel.setProperty("/clientes", clientes);
                    sap.m.MessageToast.show("Cliente adicionado!");
                    oDialog.close();
                  } else {
                    sap.m.MessageToast.show("Preencha todos os campos!");
                  }
                }
              }),
              endButton: new sap.m.Button({
                text: "Cancelar",
                type: "Reject",
                press: function () { oDialog.close(); }
              }),
              afterClose: function() { oDialog.destroy(); }
            });
            oDialog.open();
          }
        });

        // ==============================
        // Tabela de clientes com botão deletar
        // ==============================
        var oTable = new sap.m.Table({
          inset: false,
          headerText: "Lista de Clientes",
          columns: [
            new sap.m.Column({header: new sap.m.Label({text: "Nome"})}),
            new sap.m.Column({header: new sap.m.Label({text: "Cidade"})}),
            new sap.m.Column({header: new sap.m.Label({text: "Idade"})}),
            new sap.m.Column({header: new sap.m.Label({text: "Ações"})})
          ],
          itemPress: function(oEvent){
            var oItem = oEvent.getParameter("listItem");
            var oData = oItem.getBindingContext().getObject();
            oModel.setProperty("/clienteSelecionado", oData);
            oApp.to("page2");
          }
        });

        oTable.bindItems({
          path: "/clientes",
          template: new sap.m.ColumnListItem({
            cells: [
              new sap.m.Text({text: "{nome}"}),
              new sap.m.Text({text: "{cidade}"}),
              new sap.m.Text({text: "{idade}"}),
              new sap.m.Button({
                text: "Deletar",
                type: "Reject",
                icon: "sap-icon://delete",
                press: function(oEvent){
                  var oItem = oEvent.getSource().getParent();
                  var oData = oItem.getBindingContext().getObject();
                  var clientes = oModel.getProperty("/clientes");
                  var index = clientes.indexOf(oData);
                  if(index > -1){
                    clientes.splice(index, 1);
                    oModel.setProperty("/clientes", clientes);
                    sap.m.MessageToast.show("Cliente deletado!");
                  }
                }
              })
            ]
          })
        });

        // Campo de busca
        var oSearch = new sap.m.SearchField({
          placeholder: "Buscar cliente...",
          liveChange: function (oEvent) {
            var sQuery = oEvent.getParameter("newValue");
            var oBinding = oTable.getBinding("items");
            var aFilters = [];
            if (sQuery) {
              aFilters.push(new sap.ui.model.Filter("nome", sap.ui.model.FilterOperator.Contains, sQuery));
            }
            oBinding.filter(aFilters);
          }
        });

        // Página 1 - Lista
        var oPage1 = new sap.m.Page("page1", {
          title: "Clientes - SAPUI5 CRUD",
          content: [
            new sap.m.Bar({
              contentMiddle: [oSearch],
              contentRight: [oThemeButton, oAddButton]
            }),
            oTable
          ]
        });

        // Página 2 - Detalhes + Formulário
        var oForm = new sap.ui.layout.form.SimpleForm({
          editable: true,
          title: "Editar Cliente",
          content: [
            new sap.m.Label({text: "Nome"}), new sap.m.Input({value: "{/clienteSelecionado/nome}"}),
            new sap.m.Label({text: "Cidade"}), new sap.m.Input({value: "{/clienteSelecionado/cidade}"}),
            new sap.m.Label({text: "Idade"}), new sap.m.Input({value: "{/clienteSelecionado/idade}", type: "Number"}),
            new sap.m.Label({text: "Email"}), new sap.m.Input({value: "{/clienteSelecionado/email}"})
          ]
        });

        var oSaveButton = new sap.m.Button({
          text: "Salvar Alterações",
          type: "Accept",
          icon: "sap-icon://save",
          press: function () {
            sap.m.MessageToast.show("Alterações salvas!");
            oApp.back();
          }
        });

        var oPage2 = new sap.m.Page("page2", {
          title: "Detalhes do Cliente",
          showNavButton: true,
          navButtonPress: function() { oApp.back(); },
          content: [
            new sap.m.ObjectHeader({
              title: "{/clienteSelecionado/nome}",
              number: "{/clienteSelecionado/idade}",
              numberUnit: "anos",
              attributes: [
                new sap.m.ObjectAttribute({text: "{/clienteSelecionado/cidade}"}),
                new sap.m.ObjectAttribute({text: "{/clienteSelecionado/email}"})
              ]
            }),
            oForm,
            oSaveButton
          ]
        });

        // Criar App
        var oApp = new sap.m.App({initialPage: "page1"});
        oApp.addPage(oPage1).addPage(oPage2);
        oApp.placeAt("content");

      });
    </script>
  </head>
  <body class="sapUiBody" id="content"></body>
</html>
